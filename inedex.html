<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #7c3aed, #9333ea);
        }
        .product-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .offer-badge {
            background: linear-gradient(45deg, #ef4444, #dc2626);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-full">
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-900">Product Showcase</h1>
            <p class="text-gray-600 mt-2">Discover amazing products with exclusive offers</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Products will be displayed here -->
        </div>
        
        <div id="empty-state" class="text-center py-16">
            <div class="text-6xl mb-4">üì¶</div>
            <h2 class="text-2xl font-bold text-gray-700 mb-2">No Products Yet</h2>
            <p class="text-gray-500 mb-6">Use the admin panel to add your first product</p>
            <button onclick="document.getElementById('admin-toggle').click()" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                Open Admin Panel
            </button>
        </div>
    </main>

    <!-- Admin Toggle Button -->
    <div class="fixed bottom-4 right-4 z-50">
        <button id="admin-toggle" class="bg-purple-600 text-white p-3 rounded-full shadow-lg hover:bg-purple-700 transition-colors">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
            </svg>
        </button>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="bg-white w-full max-w-4xl mx-auto mt-8 mb-8 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Product Management</h2>
                    <button id="close-admin" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <button id="add-product-btn" class="btn-primary text-white px-6 py-2 rounded-lg font-semibold mb-6">
                    Add New Product
                </button>
                
                <div id="add-product-form" class="hidden bg-gray-50 p-6 rounded-lg mb-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Add New Product</h3>
                    <form id="product-form" class="space-y-4">
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label for="product-name" class="block text-sm font-medium text-gray-700 mb-2">Product Name</label>
                                <input type="text" id="product-name" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="product-price" class="block text-sm font-medium text-gray-700 mb-2">Original Price (‚Çπ)</label>
                                <input type="number" id="product-price" name="price" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="product-offer-price" class="block text-sm font-medium text-gray-700 mb-2">Offer Price (‚Çπ) - Optional</label>
                                <input type="number" id="product-offer-price" name="offerPrice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label for="offer-end-date" class="block text-sm font-medium text-gray-700 mb-2">Offer End Date (Optional)</label>
                                <input type="datetime-local" id="offer-end-date" name="offerEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <p class="text-sm text-gray-500 mt-1">Set when the offer expires</p>
                            </div>
                            <div>
                                <label for="offer-message" class="block text-sm font-medium text-gray-700 mb-2">Offer Message (Optional)</label>
                                <input type="text" id="offer-message" name="offerMessage" placeholder="Limited Time Offer!" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                        </div>
                        
                        <div>
                            <label for="product-images" class="block text-sm font-medium text-gray-700 mb-2">Product Images</label>
                            <input type="file" id="product-images" name="images" multiple accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">Select multiple images for your product</p>
                            
                            <!-- Image Preview Container -->
                            <div id="image-preview" class="hidden mt-4 flex flex-wrap gap-3">
                                <!-- Image previews will appear here -->
                            </div>
                        </div>
                        
                        <div>
                            <label for="product-description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="product-description" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Describe your product..."></textarea>
                        </div>
                        
                        <div class="flex gap-4 pt-4">
                            <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg font-semibold">
                                Add Product
                            </button>
                            <button type="button" id="cancel-add" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-semibold hover:bg-gray-400">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
                
                <div id="products-list">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Existing Products</h3>
                    <div id="admin-products-container" class="space-y-4">
                        <!-- Admin product list will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Initializations and Admin Panel Toggles ---
        let products = JSON.parse(localStorage.getItem('trivexzen_products')) || [];
        let nextId = parseInt(localStorage.getItem('nextProductId')) || 1;
        let selectedImages = []; // Stores Base64 or local image paths
        
        // Admin Panel Controls
        const adminToggle = document.getElementById('admin-toggle');
        const adminPanel = document.getElementById('admin-panel');
        const closeAdmin = document.getElementById('close-admin');
        const addProductBtn = document.getElementById('add-product-btn');
        const addProductForm = document.getElementById('add-product-form');
        const cancelAdd = document.getElementById('cancel-add');
        const productForm = document.getElementById('product-form');
        const imageInput = document.getElementById('product-images');
        const imagePreview = document.getElementById('image-preview');
        const productsGrid = document.getElementById('products-grid');
        const emptyState = document.getElementById('empty-state');
        const adminProductsContainer = document.getElementById('admin-products-container');

        // Toggle Admin Panel visibility
        adminToggle.addEventListener('click', () => {
            adminPanel.classList.remove('hidden');
            renderAdminProducts(); // Load existing products
        });
        
        // Close Admin Panel
        closeAdmin.addEventListener('click', () => {
            adminPanel.classList.add('hidden');
            addProductForm.classList.add('hidden');
        });
        
        // Toggle Add Product Form visibility
        addProductBtn.addEventListener('click', () => {
            addProductForm.classList.toggle('hidden');
        });
        
        // Cancel Add Product and reset form
        cancelAdd.addEventListener('click', () => {
            addProductForm.classList.add('hidden');
            productForm.reset();
            selectedImages = [];
            if (imagePreview) {
                imagePreview.innerHTML = '';
                imagePreview.classList.add('hidden');
            }
        });

        // --- Image Preview Functionality ---
        if (imageInput) {
            imageInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                selectedImages = [];
                
                if (files.length === 0) {
                    if (imagePreview) {
                        imagePreview.innerHTML = '';
                        imagePreview.classList.add('hidden');
                    }
                    return;
                }
                
                files.forEach((file, index) => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            selectedImages[index] = e.target.result;
                            displayImagePreviews();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        }

        productForm.addEventListener('submit', (e) => {
            e.preventDefault();
            addProduct();
        });

        // Close admin panel when clicking outside
        adminPanel.addEventListener('click', (e) => {
            if (e.target === adminPanel) {
                adminPanel.classList.add('hidden');
            }
        });

        function displayImagePreviews() {
            if (!imagePreview) return;
            
            if (selectedImages.length === 0) {
                imagePreview.innerHTML = '';
                imagePreview.classList.add('hidden');
                return;
            }
            
            imagePreview.classList.remove('hidden');
            imagePreview.innerHTML = selectedImages.map((src, index) => `
                <div class="relative">
                    <img src="${src}" alt="Preview ${index + 1}" class="w-20 h-20 object-cover rounded-lg border">
                    <button type="button" onclick="removeImage(${index})" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                        √ó
                    </button>
                </div>
            `).join('');
        }

        function removeImage(index) {
            selectedImages.splice(index, 1);
            displayImagePreviews();
        }

        function addProduct() {
            const formData = new FormData(productForm);
            const product = {
                id: nextId++,
                name: formData.get('name'),
                price: parseFloat(formData.get('price')),
                offerPrice: formData.get('offerPrice') ? parseFloat(formData.get('offerPrice')) : null,
                offerEndDate: formData.get('offerEndDate') || null,
                offerMessage: formData.get('offerMessage') || null,
                description: formData.get('description') || '',
                images: [...selectedImages], // Store selected images
                createdAt: new Date().toISOString()
            };

            products.push(product);
            saveProducts();
            renderProducts();
            renderAdminProducts();
            productForm.reset();
            selectedImages = [];
            if (imagePreview) {
                imagePreview.innerHTML = '';
                imagePreview.classList.add('hidden');
            }
            addProductForm.classList.add('hidden');
            
            // Show success message
            showNotification('Product added successfully!', 'success');
        }

        function deleteProduct(id) {
            products = products.filter(p => p.id !== id);
            saveProducts();
            renderProducts();
            renderAdminProducts();
            showNotification('Product deleted successfully!', 'success');
        }

        function saveProducts() {
            localStorage.setItem('trivexzen_products', JSON.stringify(products));
            localStorage.setItem('nextProductId', nextId.toString());
        }

        function isOfferActive(product) {
            if (!product.offerPrice || !product.offerEndDate) return false;
            return new Date() < new Date(product.offerEndDate);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function renderProducts() {
            if (products.length === 0) {
                productsGrid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            productsGrid.classList.remove('hidden');
            emptyState.classList.add('hidden');

            productsGrid.innerHTML = products.map(product => {
                const hasActiveOffer = isOfferActive(product);
                const displayPrice = hasActiveOffer ? product.offerPrice : product.price;
                const savings = hasActiveOffer ? product.price - product.offerPrice : 0;
                const savingsPercent = hasActiveOffer ? Math.round((savings / product.price) * 100) : 0;

                return `
                    <div class="product-card bg-white rounded-xl shadow-md overflow-hidden">
                        ${product.images && product.images.length > 0 ? `
                            <div class="relative h-48 bg-gray-100">
                                <img src="${product.images[0]}" alt="${product.name}" class="w-full h-full object-cover">
                                ${product.images.length > 1 ? `
                                    <div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">
                                        +${product.images.length - 1} more
                                    </div>
                                ` : ''}
                                ${hasActiveOffer ? `
                                    <div class="absolute top-2 left-2 offer-badge text-white text-xs font-bold px-2 py-1 rounded-full">
                                        ${savingsPercent}% OFF
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        <div class="p-6">
                            ${!product.images || product.images.length === 0 ? (hasActiveOffer ? `
                                <div class="offer-badge text-white text-xs font-bold px-2 py-1 rounded-full inline-block mb-3">
                                    ${savingsPercent}% OFF
                                </div>
                            ` : '') : ''}
                            
                            <h3 class="text-xl font-bold text-gray-900 mb-2">${product.name}</h3>
                            
                            <div class="mb-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-2xl font-bold text-purple-600">‚Çπ${displayPrice.toLocaleString('en-IN')}</span>
                                    ${hasActiveOffer ? `
                                        <span class="text-lg text-gray-500 line-through">‚Çπ${product.price.toLocaleString('en-IN')}</span>
                                    ` : ''}
                                </div>
                                ${hasActiveOffer ? `
                                    <p class="text-sm text-green-600 font-medium">Save ‚Çπ${savings.toLocaleString('en-IN')}</p>
                                ` : ''}
                            </div>
                            
                            ${product.description ? `
                                <p class="text-gray-600 mb-4 line-clamp-2">${product.description}</p>
                            ` : ''}
                            
                            ${hasActiveOffer && product.offerEndDate ? `
                                <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                                    ${product.offerMessage ? <p class="text-red-700 font-medium text-sm mb-2">${product.offerMessage}</p> : ''}
                                    <div class="text-red-600 text-sm font-medium">
                                        <div class="flex items-center gap-2">
                                            <span>‚è∞ Offer ends in:</span>
                                        </div>
                                        <div id="timer-${product.id}" class="text-lg font-bold mt-1">
                                            Loading...
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="flex gap-2">
                                <button onclick="viewProductDetails(${product.id})" class="flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg font-semibold hover:bg-gray-200 transition-all">
                                    View Details
                                </button>
                                <button onclick="buyNow(${product.id})" class="flex-1 btn-primary text-white py-2 px-4 rounded-lg font-semibold hover:shadow-lg transition-all">
                                    Buy Now
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Start timers for active offers
            products.forEach(product => {
                if (isOfferActive(product)) {
                    startCountdown(product.id, product.offerEndDate);
                }
            });
        }

        function renderAdminProducts() {
            if (products.length === 0) {
                adminProductsContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üì¶</div>
                        <p>No products added yet</p>
                    </div>
                `;
                return;
            }

            adminProductsContainer.innerHTML = products.map(product => {
                const hasActiveOffer = isOfferActive(product);
                
                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div class="flex items-start gap-3 flex-1">
                                ${product.images && product.images.length > 0 ? `
                                    <img src="${product.images[0]}" alt="${product.name}" class="w-12 h-12 object-cover rounded border">
                                ` : `
                                    <div class="w-12 h-12 bg-gray-200 rounded border flex items-center justify-center text-gray-400 text-xs">
                                        No Image
                                    </div>
                                `}
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-900">${product.name}</h4>
                                    <div class="text-sm text-gray-600 mt-1">
                                        <span>Price: ‚Çπ${product.price.toLocaleString('en-IN')}</span>
                                        ${product.offerPrice ? `
                                            <span class="ml-4">Offer: ‚Çπ${product.offerPrice.toLocaleString('en-IN')}</span>
                                            <span class="ml-2 px-2 py-1 text-xs rounded ${hasActiveOffer ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                ${hasActiveOffer ? 'Active' : 'Expired'}
                                            </span>
                                        ` : ''}
                                    </div>
                                    ${product.offerEndDate ? `
                                        <div class="text-xs text-gray-500 mt-1">
                                            Offer ends: ${formatDate(product.offerEndDate)}
                                        </div>
                                    ` : ''}
                                    ${product.images && product.images.length > 1 ? `
                                        <div class="text-xs text-blue-600 mt-1">
                                            ${product.images.length} images uploaded
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-800 ml-4">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium ${
                type === 'success' ? 'bg-green-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Countdown timer functionality
        let timers = {};

        function startCountdown(productId, endDate) {
            if (timers[productId]) {
                clearInterval(timers[productId]);
            }

            timers[productId] = setInterval(() => {
                const now = new Date().getTime();
                const end = new Date(endDate).getTime();
                const distance = end - now;

                const timerElement = document.getElementById(timer-${productId});
                if (!timerElement) {
                    clearInterval(timers[productId]);
                    return;
                }

                if (distance < 0) {
                    clearInterval(timers[productId]);
                    timerElement.innerHTML = "EXPIRED";
                    timerElement.className = "text-lg font-bold mt-1 text-gray-500";
                    // Refresh products to update expired offers
                    setTimeout(() => renderProducts(), 1000);
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                let timeString = '';
                if (days > 0) {
                    timeString = ${days}d ${hours}h ${minutes}m ${seconds}s;
                } else if (hours > 0) {
                    timeString = ${hours}h ${minutes}m ${seconds}s;
                } else {
                    timeString = ${minutes}m ${seconds}s;
                }

                timerElement.innerHTML = timeString;
            }, 1000);
        }

        // Product details modal functionality
        function viewProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const hasActiveOffer = isOfferActive(product);
            const displayPrice = hasActiveOffer ? product.offerPrice : product.price;
            const savings = hasActiveOffer ? product.price - product.offerPrice : 0;
            const savingsPercent = hasActiveOffer ? Math.round((savings / product.price) * 100) : 0;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-gray-900">${product.name}</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                ${product.images && product.images.length > 0 ? `
                                    <div class="space-y-4">
                                        <div class="relative">
                                            <img id="main-image" src="${product.images[0]}" alt="${product.name}" class="w-full h-80 object-cover rounded-lg border">
                                            ${hasActiveOffer ? `
                                                <div class="absolute top-4 left-4 offer-badge text-white text-sm font-bold px-3 py-1 rounded-full">
                                                    ${savingsPercent}% OFF
                                                </div>
                                            ` : ''}
                                        </div>
                                        ${product.images.length > 1 ? `
                                            <div class="flex gap-2 overflow-x-auto">
                                                ${product.images.map((img, index) => `
                                                    <img src="${img}" alt="Image ${index + 1}" 
                                                         class="w-16 h-16 object-cover rounded border cursor-pointer hover:border-purple-500 ${index === 0 ? 'border-purple-500' : ''}"
                                                         onclick="document.getElementById('main-image').src = this.src; document.querySelectorAll('.w-16').forEach(el => el.classList.remove('border-purple-500')); this.classList.add('border-purple-500');">
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : `
                                    <div class="w-full h-80 bg-gray-200 rounded-lg border flex items-center justify-center">
                                        <div class="text-center text-gray-500">
                                            <div class="text-4xl mb-2">üì∑</div>
                                            <p>No images available</p>
                                        </div>
                                    </div>
                                `}
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-3xl font-bold text-purple-600">‚Çπ${displayPrice.toLocaleString('en-IN')}</span>
                                        ${hasActiveOffer ? `
                                            <span class="text-xl text-gray-500 line-through">‚Çπ${product.price.toLocaleString('en-IN')}</span>
                                        ` : ''}
                                    </div>
                                    ${hasActiveOffer ? `
                                        <p class="text-green-600 font-medium">You save ‚Çπ${savings.toLocaleString('en-IN')} (${savingsPercent}% off)</p>
                                    ` : ''}
                                </div>
                                
                                ${hasActiveOffer && product.offerEndDate ? `
                                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                        ${product.offerMessage ? <p class="text-red-700 font-medium mb-2">${product.offerMessage}</p> : ''}
                                        <div class="text-red-600 font-medium">
                                            <div class="flex items-center gap-2 mb-2">
                                                <span>‚è∞ Offer ends in:</span>
                                            </div>
                                            <div id="modal-timer-${product.id}" class="text-xl font-bold">
                                                Loading...
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${product.description ? `
                                    <div>
                                        <h3 class="font-semibold text-gray-900 mb-2">Description</h3>
                                        <p class="text-gray-600 leading-relaxed">${product.description}</p>
                                    </div>
                                ` : ''}
                                
                                <div class="pt-4">
                                    <button onclick="buyNow(${product.id})" class="w-full btn-primary text-white py-3 rounded-lg font-semibold text-lg hover:shadow-lg transition-all">
                                        Buy Now - ‚Çπ${displayPrice.toLocaleString('en-IN')}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Start countdown for modal if offer is active
            if (hasActiveOffer && product.offerEndDate) {
                startModalCountdown(product.id, product.offerEndDate);
            }

            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function startModalCountdown(productId, endDate) {
            const modalTimer = setInterval(() => {
                const now = new Date().getTime();
                const end = new Date(endDate).getTime();
                const distance = end - now;

                const timerElement = document.getElementById(modal-timer-${productId});
                if (!timerElement) {
                    clearInterval(modalTimer);
                    return;
                }

                if (distance < 0) {
                    clearInterval(modalTimer);
                    timerElement.innerHTML = "EXPIRED";
                    timerElement.className = "text-xl font-bold text-gray-500";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                let timeString = '';
                if (days > 0) {
                    timeString = ${days}d ${hours}h ${minutes}m ${seconds}s;
                } else if (hours > 0) {
                    timeString = ${hours}h ${minutes}m ${seconds}s;
                } else {
                    timeString = ${minutes}m ${seconds}s;
                }

                timerElement.innerHTML = timeString;
            }, 1000);
        }

        // WhatsApp Buy Now functionality
        function buyNow(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const hasActiveOffer = isOfferActive(product);
            const displayPrice = hasActiveOffer ? product.offerPrice : product.price;
            const savings = hasActiveOffer ? product.price - product.offerPrice : 0;
            
            // Create WhatsApp message
            let message = üõí *Product Inquiry*\n\n;
            message += üì¶ *Product:* ${product.name}\n;
            message += üí∞ *Price:* ‚Çπ${displayPrice.toLocaleString('en-IN')};
            
            if (hasActiveOffer) {
                message += ` (${Math.round((savings / product.price) * 100)}% OFF)\n`;
                message += ~~‚Çπ${product.price.toLocaleString('en-IN')}~~ *You save ‚Çπ${savings.toLocaleString('en-IN')}*\n;
            } else {
                message += \n;
            }
            
            if (product.description) {
                message += üìù *Description:* ${product.description}\n;
            }
            
            if (hasActiveOffer && product.offerEndDate) {
                message += ‚è∞ *Offer valid until:* ${formatDate(product.offerEndDate)}\n;
            }
            
            message += \nI'm interested in purchasing this product. Please provide more details.;
            
            // Encode message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Open WhatsApp with pre-filled message using correct phone number
            const whatsappUrl = https://wa.me/+917025751941?text=${encodedMessage};
            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
        }

        // Initialize the app
        renderProducts();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'994358c0c4d77f17',t:'MTc2MTQxMjQyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
